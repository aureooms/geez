#!/usr/bin/env node
'use strict';

var _execa = require('execa');

var _execa2 = _interopRequireDefault(_execa);

var _listr = require('listr');

var _listr2 = _interopRequireDefault(_listr);

var _repos = require('./repos');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const cwd = '.';

const args = process.argv.slice(2);

if (args.length !== 1) {
	console.error('usage: geez {pull|push}');
	process.exit(2);
}
const available_commands = ['pull', 'push'];

const cmd = args[0];

if (!available_commands.includes(cmd)) {
	console.error(`Unknown command '${cmd}'.`);
	process.exit(2);
}

const tasks = new _listr2.default([{
	title: 'Searching for repos',
	task: ctx => (0, _repos.repos_promise)(cwd).then(repos => {
		ctx.repos = repos;
	})
}, {
	title: `${cmd[0].toUpperCase()}${cmd.substring(1)}ing repos`,
	task: ctx => {

		const pullingtasks = ctx.repos.map(repo => ({
			title: repo,
			task: () => (0, _execa2.default)('git', ['-C', repo, cmd])
		}));

		return new _listr2.default(pullingtasks, {
			concurrent: true,
			exitOnError: false
		});
	}
}], {
	collapse: false
});

tasks.run().catch(err => {
	//console.error(err);
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9jbGkuanMiXSwibmFtZXMiOlsiY3dkIiwiYXJncyIsInByb2Nlc3MiLCJhcmd2Iiwic2xpY2UiLCJsZW5ndGgiLCJjb25zb2xlIiwiZXJyb3IiLCJleGl0IiwiYXZhaWxhYmxlX2NvbW1hbmRzIiwiY21kIiwiaW5jbHVkZXMiLCJ0YXNrcyIsInRpdGxlIiwidGFzayIsImN0eCIsInRoZW4iLCJyZXBvcyIsInRvVXBwZXJDYXNlIiwic3Vic3RyaW5nIiwicHVsbGluZ3Rhc2tzIiwibWFwIiwicmVwbyIsImNvbmN1cnJlbnQiLCJleGl0T25FcnJvciIsImNvbGxhcHNlIiwicnVuIiwiY2F0Y2giLCJlcnIiXSwibWFwcGluZ3MiOiI7O0FBRUE7Ozs7QUFDQTs7OztBQUNBOzs7O0FBRUEsTUFBTUEsTUFBTSxHQUFaOztBQUVBLE1BQU1DLE9BQU9DLFFBQVFDLElBQVIsQ0FBYUMsS0FBYixDQUFtQixDQUFuQixDQUFiOztBQUVBLElBQUtILEtBQUtJLE1BQUwsS0FBZ0IsQ0FBckIsRUFBeUI7QUFDeEJDLFNBQVFDLEtBQVIsQ0FBYyx5QkFBZDtBQUNBTCxTQUFRTSxJQUFSLENBQWEsQ0FBYjtBQUNBO0FBQ0QsTUFBTUMscUJBQXFCLENBQUUsTUFBRixFQUFXLE1BQVgsQ0FBM0I7O0FBRUEsTUFBTUMsTUFBTVQsS0FBSyxDQUFMLENBQVo7O0FBRUEsSUFBSyxDQUFFUSxtQkFBbUJFLFFBQW5CLENBQTRCRCxHQUE1QixDQUFQLEVBQTBDO0FBQ3pDSixTQUFRQyxLQUFSLENBQWUsb0JBQW1CRyxHQUFJLElBQXRDO0FBQ0FSLFNBQVFNLElBQVIsQ0FBYSxDQUFiO0FBQ0E7O0FBRUQsTUFBTUksUUFBUSxvQkFBVSxDQUN2QjtBQUNDQyxRQUFPLHFCQURSO0FBRUNDLE9BQU1DLE9BQU8sMEJBQWNmLEdBQWQsRUFBbUJnQixJQUFuQixDQUF5QkMsU0FBUztBQUFFRixNQUFJRSxLQUFKLEdBQVlBLEtBQVo7QUFBcUIsRUFBekQ7QUFGZCxDQUR1QixFQUt2QjtBQUNDSixRQUFRLEdBQUVILElBQUksQ0FBSixFQUFPUSxXQUFQLEVBQXFCLEdBQUVSLElBQUlTLFNBQUosQ0FBYyxDQUFkLENBQWlCLFdBRG5EO0FBRUNMLE9BQU1DLE9BQU87O0FBRVosUUFBTUssZUFBZUwsSUFBSUUsS0FBSixDQUFVSSxHQUFWLENBQWNDLFNBQVM7QUFDM0NULFVBQU9TLElBRG9DO0FBRTNDUixTQUFNLE1BQU0scUJBQU0sS0FBTixFQUFhLENBQUMsSUFBRCxFQUFPUSxJQUFQLEVBQWFaLEdBQWIsQ0FBYjtBQUYrQixHQUFULENBQWQsQ0FBckI7O0FBS0EsU0FBTyxvQkFBVVUsWUFBVixFQUF3QjtBQUM5QkcsZUFBVyxJQURtQjtBQUU5QkMsZ0JBQVk7QUFGa0IsR0FBeEIsQ0FBUDtBQUtBO0FBZEYsQ0FMdUIsQ0FBVixFQXFCWDtBQUNGQyxXQUFVO0FBRFIsQ0FyQlcsQ0FBZDs7QUEwQkFiLE1BQU1jLEdBQU4sR0FBWUMsS0FBWixDQUFrQkMsT0FBTztBQUN4QjtBQUNBLENBRkQiLCJmaWxlIjoiY2xpLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXG5cbmltcG9ydCBleGVjYSBmcm9tICdleGVjYScgO1xuaW1wb3J0IExpc3RyIGZyb20gJ2xpc3RyJyA7XG5pbXBvcnQgeyByZXBvc19wcm9taXNlIH0gZnJvbSAgJy4vcmVwb3MnIDtcblxuY29uc3QgY3dkID0gJy4nIDtcblxuY29uc3QgYXJncyA9IHByb2Nlc3MuYXJndi5zbGljZSgyKTtcblxuaWYgKCBhcmdzLmxlbmd0aCAhPT0gMSApIHtcblx0Y29uc29sZS5lcnJvcigndXNhZ2U6IGdlZXoge3B1bGx8cHVzaH0nKTtcblx0cHJvY2Vzcy5leGl0KDIpO1xufVxuY29uc3QgYXZhaWxhYmxlX2NvbW1hbmRzID0gWyAncHVsbCcgLCAncHVzaCcgXSA7XG5cbmNvbnN0IGNtZCA9IGFyZ3NbMF0gO1xuXG5pZiAoICEgYXZhaWxhYmxlX2NvbW1hbmRzLmluY2x1ZGVzKGNtZCkgKSB7XG5cdGNvbnNvbGUuZXJyb3IoYFVua25vd24gY29tbWFuZCAnJHtjbWR9Jy5gKTtcblx0cHJvY2Vzcy5leGl0KDIpO1xufVxuXG5jb25zdCB0YXNrcyA9IG5ldyBMaXN0cihbXG5cdHtcblx0XHR0aXRsZTogJ1NlYXJjaGluZyBmb3IgcmVwb3MnLFxuXHRcdHRhc2s6IGN0eCA9PiByZXBvc19wcm9taXNlKGN3ZCkudGhlbiggcmVwb3MgPT4geyBjdHgucmVwb3MgPSByZXBvcyA7IH0gKVxuXHR9LFxuXHR7XG5cdFx0dGl0bGU6IGAke2NtZFswXS50b1VwcGVyQ2FzZSgpfSR7Y21kLnN1YnN0cmluZygxKX1pbmcgcmVwb3NgLFxuXHRcdHRhc2s6IGN0eCA9PiB7XG5cblx0XHRcdGNvbnN0IHB1bGxpbmd0YXNrcyA9IGN0eC5yZXBvcy5tYXAocmVwbyA9PiAoe1xuXHRcdFx0XHR0aXRsZTogcmVwbyxcblx0XHRcdFx0dGFzazogKCkgPT4gZXhlY2EoJ2dpdCcsIFsnLUMnLCByZXBvLCBjbWRdKVxuXHRcdFx0fSkpO1xuXG5cdFx0XHRyZXR1cm4gbmV3IExpc3RyKHB1bGxpbmd0YXNrcywge1xuXHRcdFx0XHRjb25jdXJyZW50OnRydWUsXG5cdFx0XHRcdGV4aXRPbkVycm9yOmZhbHNlXG5cdFx0XHR9KTtcblxuXHRcdH1cblx0fVxuXSwge1xuXHRjb2xsYXBzZTogZmFsc2UsXG5cdC8vc2hvd1N1YnRhc2tzOiBmYWxzZVxufSk7XG5cbnRhc2tzLnJ1bigpLmNhdGNoKGVyciA9PiB7XG5cdC8vY29uc29sZS5lcnJvcihlcnIpO1xufSk7XG4iXX0=